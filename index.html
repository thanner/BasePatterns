<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Base Patterns by thanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Base Patterns</h1>
      <h2 class="project-tagline">Trabalho de Laboratório de Engenharia de Software</h2>
      <a href="https://github.com/thanner/BasePatterns" class="btn">View on GitHub</a>
      <a href="https://github.com/thanner/BasePatterns/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/thanner/BasePatterns/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="trabalho" class="anchor" href="#trabalho" aria-hidden="true"><span class="octicon octicon-link"></span></a>Trabalho</h3>

<p>O trabalho em questão busca explicar e implementar os principais Base Patterns baseados no livro de Martin Fowler (Patterns of Enterprise Application). Os padrões presentes nesse projeto são: Gateway, Mapper, Layer Supertype, Separated Interface, Registry, Value Object, Money, Special Case, Plugin, Service Stub, Record Set.</p>

<h3>
<a id="gateway" class="anchor" href="#gateway" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gateway</h3>

<p>Um objeto que encapsula o acesso a um sistema externo ou recurso.</p>

<p>Classe Teste</p>

<pre><code>public static void main(String[] args) {
    Order order = new Order();
    order.sendConfirmacao();
}
</code></pre>

<p>Classe Order</p>

<pre><code>private int valorTotal = 100;
public static final String SIMBOLO = "R$";
private String idOrder = "10";

public void sendConfirmacao() {
    MenssageGateway msg = new MenssageGateway();
    msg.sendConfirmacao(idOrder, valorTotal, SIMBOLO);
}
</code></pre>

<p>Classe MenssageSender</p>

<pre><code>public final static int PARAMETRO_NULO = -1;
public final static int TIPO_MENSAGEM_DESCONHECIDA = -2;
public final static int SUCESSO = 0;

public int send(String msg, Object[] args) {
    return 0;
}
</code></pre>

<p>Classe MenssageGateway</p>

<pre><code>protected static final String CONFIRMACAO = "CNFRM";
private MenssageSender sender = new MenssageSender();

public void sendConfirmacao(String orderID, int amount,
        String symbol) {
    Object[] args = new Object[]{orderID, new Integer(amount),
        symbol};
    send(CONFIRMACAO, args);
}

private void send(String msg, Object[] args) {
    int returnCode = doSend(msg, args);
    if (returnCode == MenssageSender.PARAMETRO_NULO) {
        throw new NullPointerException("Parametro null: " + msg);
    }
    if (returnCode == MenssageSender.TIPO_MENSAGEM_DESCONHECIDA) {
        throw new IllegalStateException(
                "Inesperado erro do sistema de mensagem #:" + returnCode);
    }
    if (returnCode == MenssageSender.SUCESSO) {
        System.out.println("Sucesso");
    }
}

protected int doSend(String msg, Object[] args) {
    assert (msg != null);
    return sender.send(msg, args);
}
</code></pre>

<h3>
<a id="mapper" class="anchor" href="#mapper" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mapper</h3>

<p>Um objeto que estabelece uma comunicação entre dois objetos independentes.</p>

<h3>
<a id="layer-supertype" class="anchor" href="#layer-supertype" aria-hidden="true"><span class="octicon octicon-link"></span></a>Layer Supertype</h3>

<p>Um tipo que atua como o supertipo para todos os tipos, na sua camada.</p>

<p>Classe Teste</p>

<pre><code>public static void main(String[] args) {
    DomainObject domainExample = new DomainExample(Long.valueOf("2"));
    System.out.println(domainExample.getClass());
}
</code></pre>

<p>Classe DomainObject</p>

<pre><code>private Long ID;

public Long getID() {
    return ID;
}

public void setID(Long ID) {
    // assert.notNull("Cannot set a null ID", ID);
    this.ID = ID;
}

public DomainObject(Long ID) {
    this.ID = ID;
}

public DomainObject() {

}
</code></pre>

<p>Classe DomainExample (Extends DomainObject)</p>

<pre><code>public DomainExample(Long ID) {
    super(ID);
}
</code></pre>

<h3>
<a id="separated-interface" class="anchor" href="#separated-interface" aria-hidden="true"><span class="octicon octicon-link"></span></a>Separated Interface</h3>

<p>Define uma interface em um pacote separado a partir de sua implementação.</p>

<p>Pacote Modelo - Interface UsuarioDAO</p>

<pre><code>public static final UsuarioDAO INSTANCIA
        = (UsuarioDAO) PluginFactory.getPlugin(UsuarioDAO.class);

public void insert(Usuario u) throws SQLException, IOException;
</code></pre>

<p>Pacote Modelo - Classe Usuario</p>

<pre><code>private String login;
private String senha;

public void insereUsuario() throws SQLException, IOException {
    if (login != null &amp;&amp; senha != null) {
        UsuarioDAO dao = new UsuarioDAOImpl();
        dao.insert(this);
    }
}

public void insereUsuarioComPlugin() throws SQLException, IOException {
    if (login != null &amp;&amp; senha != null) {
        UsuarioDAO.INSTANCIA.insert(this);
    }
}

public String getLogin() {
    return login;
}

public String getSenha() {
    return senha;
}
</code></pre>

<p>Pacote dao - Classe UsuarioDAOImpl (Implementa UsuarioDAO)</p>

<pre><code>private Connection con;

public void setConnection(Connection con) {
    this.con = con;
}

public void insert(Usuario u) throws SQLException {
    PreparedStatement st = con.prepareStatement("INSERT INTO USUARIO (login, senha) values (?, ?)");
    st.setString(1, u.getLogin());
    st.setString(2, u.getSenha());
    st.executeUpdate();
    st.close();
}
</code></pre>

<h3>
<a id="registry" class="anchor" href="#registry" aria-hidden="true"><span class="octicon octicon-link"></span></a>Registry</h3>

<p>Um objeto conhecido que outros objetos podem usar para encontrar objetos e serviços comuns.</p>

<p>Classe RegistryStub</p>

<pre><code>public RegistryStub() {
    personFinderStub = new PersonFinderStub();
}
</code></pre>

<p>Classe Registry</p>

<pre><code>private static Registry getInstance() {
    return soleInstance;
}
private static Registry soleInstance = new Registry();
protected PersonFinderStub personFinderStub = new PersonFinderStub();

public static PersonFinderStub personFinder() {
    return getInstance().personFinderStub;
}

public static void initialize() {
    soleInstance = new Registry();
}

public static void initializeStub() {
    soleInstance = new RegistryStub();
}
</code></pre>

<p>Classe PersonFinderStub</p>

<pre><code>public Person find(long id) {
    if (id == 1) {
        return new Person("Soares", "Thanner", 10);
    }
    throw new IllegalArgumentException("Con't find id: " + String.valueOf(id));
}
</code></pre>

<p>Classe Person</p>

<pre><code>private String nome;
private String sobrenome;
private int i;

Person(String sobrenome, String nome, int i) {
    this.nome = nome;
    this.sobrenome = sobrenome;
    this.i = i;
}

public String getNome() {
    return nome;
}

public void setNome(String nome) {
    this.nome = nome;
}

public String getSobrenome() {
    return sobrenome;
}

public void setSobrenome(String sobrenome) {
    this.sobrenome = sobrenome;
}

public int getI() {
    return i;
}

public void setI(int i) {
    this.i = i;
}
</code></pre>

<h3>
<a id="value-object" class="anchor" href="#value-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Value Object</h3>

<p>Um pequeno objeto simples, como dinheiro ou um intervalo de datas, cuja igualdade não é baseada em identidade.</p>

<p>Classe Teste</p>

<pre><code>public static void main(String[] args) {
    Carro carro1 = new Carro();
    carro1.setAno("1990");
    carro1.setCor("azul");
    Carro carro2 = new Carro(carro1);
    System.out.println(carro1.equals(carro2));
}
</code></pre>

<p>Classe Carro</p>

<pre><code>private String cor;
private String ano;

Carro(Carro carro) {
    this.cor = carro.getCor();
    this.ano = carro.getAno();
}

Carro() {
}

public String getCor() {
    return cor;
}

public void setCor(String cor) {
    this.cor = cor;
}

public String getAno() {
    return ano;
}

public void setAno(String ano) {
    this.ano = ano;
}

@Override
public int hashCode() {
    int hash = 3;
    hash = 67 * hash + Objects.hashCode(this.cor);
    hash = 67 * hash + Objects.hashCode(this.ano);
    return hash;
}

@Override
public boolean equals(Object obj) {
    return false;
}
</code></pre>

<h3>
<a id="money" class="anchor" href="#money" aria-hidden="true"><span class="octicon octicon-link"></span></a>Money</h3>

<p>Representa um valor monetário.</p>

<p>Classe Teste</p>

<pre><code>public static void main(String[] args) {

    Money money = new Money(20.00, Currency.getInstance(Locale.US));
    money = money.add(new Money(33.00, Currency.getInstance(Locale.US)));
    System.out.println(money.toString());
}
</code></pre>

<p>Classe Money</p>

<pre><code>private long amount;
private Currency currency;
private int roundingMode;
private BigDecimal amountBig;

public Money(){}

public Money(double amount, Currency currency) {
    this.currency = currency;
    this.amount = Math.round(amount * centFactor());
}

public Money(long amount, Currency currency) {
    this.currency = currency;
    this.amount = amount * centFactor();
}

public Money(BigDecimal amount, Currency currency, int roundingMode){
    this.amountBig = amount;
    this.currency = currency;
    this.roundingMode = roundingMode;
}

private static final int[] cents = new int[]{1, 10, 100, 1000};

private int centFactor() {
    return cents[currency.getDefaultFractionDigits()];
}

public BigDecimal amount() {
    return BigDecimal.valueOf(amount, currency.getDefaultFractionDigits());
}

public Currency currency() {
    return currency;
}

public static Money dollars(double amount) {
    return new Money(amount, Currency.getInstance(Locale.US));
}

public boolean equals(Object other) {
    return (other instanceof Money) &amp;&amp; equals((Money) other);
}

public boolean equals(Money other) {
    return currency.equals(other.currency) &amp;&amp; (amount == other.amount);
}

public int hashCode() {
    return (int) (amount ^ (amount &gt;&gt;&gt; 32));
}

public Money add(Money other) {
    assertSameCurrencyAs(other);
    return newMoney(amount + other.amount);
}

private void assertSameCurrencyAs(Money arg) {        
    assertEquals("money math mismatch", currency, arg.currency);
}

private Money newMoney(long amount) {
    Money money = new Money();
    money.currency = this.currency;
    money.amount = amount;
    return money;
}

public Money subtract(Money other) {
    assertSameCurrencyAs(other);
    return newMoney(amount - other.amount);
}

public int compareTo(Object other) {
    return compareTo((Money) other);
}

public int compareTo(Money other) {
    assertSameCurrencyAs(other);
    if (amount &lt; other.amount) {
        return -1;
    } else if (amount == other.amount) {
        return 0;
    } else {
        return 1;
    }
}

public boolean greaterThan(Money other) {
    return (compareTo(other) &gt; 0);
}

public Money multiply(double amount) {
    return multiply(new BigDecimal(amount));
}

public Money multiply(BigDecimal amount) {
    return multiply(amount, BigDecimal.ROUND_HALF_EVEN);
}

public Money multiply(BigDecimal amount, int roundingMode) {
    return new Money(amount().multiply(amount), currency, roundingMode);
}

public Money[] allocate(int n) {
    Money lowResult = newMoney(amount / n);
    Money highResult = newMoney(lowResult.amount + 1);
    Money[] results = new Money[n];
    int remainder = (int) amount % n;
    for (int i = 0; i &lt; remainder; i++) {
        results[i] = highResult;
    }
    for (int i = remainder; i &lt; n; i++) {
        results[i] = lowResult;
    }
    return results;
}

public Money[] allocate(long[] ratios) {
    long total = 0;
    for (int i = 0; i &lt; ratios.length; i++) {
        total += ratios[i];
    }
    long remainder = amount;
    Money[] results = new Money[ratios.length];
    for (int i = 0; i &lt; results.length; i++) {
        results[i] = newMoney(amount * ratios[i] / total);
        remainder -= results[i].amount;
    }
    for (int i = 0; i &lt; remainder; i++) {
        results[i].amount++;
    }
    return results;
}

public void testAllocate2() {
    long[] allocation = {3, 7};
    Money[] result = Money.dollars(0.05).allocate(allocation);
    assertEquals(Money.dollars(0.02), result[0]);
    assertEquals(Money.dollars(0.03), result[1]);
}

public String toString(){
    return this.amount + " " + this.currency.toString();
}
</code></pre>

<h3>
<a id="special-case" class="anchor" href="#special-case" aria-hidden="true"><span class="octicon octicon-link"></span></a>Special Case</h3>

<p>Uma subclasse que fornece comportamento especial para casos particulares.</p>

<p>Classe Teste</p>

<pre><code>public static void main(String[] args) {
    Employee employee = new NullEmployee();
    System.out.println(employee.getName());
}
</code></pre>

<p>Classe Employee</p>

<pre><code>private String name;

public String getName() {
    return name;
}

public void setName(String name) {
    this.name = name;
}
</code></pre>

<p>Classe NullEmployee (Extends Employee)</p>

<pre><code>public String getName() {
    return "Null Employee";
}
</code></pre>

<h3>
<a id="plugin" class="anchor" href="#plugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plugin</h3>

<p>Liga classes durante a configuração em vez de compilação.</p>

<p>Classe UsuarioDAOImplArquivo (Implements UsuarioDAO)</p>

<pre><code>public void insert(Usuario u) throws IOException {
    File arquivo = new File("/home/jadson/temp/Usuario.txt");
    FileWriter writer = new FileWriter(arquivo, true);
    PrintWriter saida = new PrintWriter(writer);
    saida.println("&lt;&lt;" + u.getClass().getSimpleName() + "&gt;&gt;");
    saida.println(u.getLogin() + " - " + u.getSenha());
    saida.close();
}
</code></pre>

<p>Classe PluginFactory</p>

<pre><code>private static Properties props = new Properties();

static {
    try {
        props.load(PluginFactory.class.getResourceAsStream("/home/jadson/temp/plugins.properties"));
    } catch (Exception ex) {
        throw new ExceptionInInitializerError(ex);
    }
}

public static Object getPlugin(Class interfaceClass) {
    String implName = props.getProperty(interfaceClass.getName());
    if (implName == null) {
        throw new RuntimeException("Implemenatacao nao exite: "
                + interfaceClass.getName());
    }
    try {
        return Class.forName(implName).newInstance();
    } catch (Exception ex) {
        throw new RuntimeException("Nao conseguiu criar uma "
                + " nova instancia: "
                + interfaceClass.getName());
    }
}
</code></pre>

<h3>
<a id="service-stub" class="anchor" href="#service-stub" aria-hidden="true"><span class="octicon octicon-link"></span></a>Service Stub</h3>

<p>Remove dependência de serviços problemáticos durante os testes.
(Exemplo presente no Registry).</p>

<h3>
<a id="record-set" class="anchor" href="#record-set" aria-hidden="true"><span class="octicon octicon-link"></span></a>Record Set</h3>

<p>Uma representação em memória de “dados tabulares”.</p>

<h3>
<a id="autor" class="anchor" href="#autor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Autor</h3>

<p>Thanner Soares Silva (<a href="https://github.com/thanner" class="user-mention">@thanner</a>).</p>

<h3>
<a id="contato" class="anchor" href="#contato" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contato</h3>

<p>Você pode estar entrando em contato com <a href="thannersoares@gmail.com">Thanner Soares Silva</a> ou acessando a <a href="https://github.com/thanner">Página do Github</a>.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/thanner/BasePatterns">Base Patterns</a> is maintained by <a href="https://github.com/thanner">thanner</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

